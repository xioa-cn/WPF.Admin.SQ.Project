<Page
    x:Class="SystemModules.Views.SystemUserView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:auth="clr-namespace:WPF.Admin.Themes.Converter;assembly=WPF.Admin.Themes"
    xmlns:convert="clr-namespace:SystemModules.Converter"
    xmlns:i18n="clr-namespace:WPF.Admin.Themes.I18n;assembly=WPF.Admin.Themes"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:SystemModules.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:SystemModules.ViewModels"
    Title="SystemUserView"
    d:DataContext="{d:DesignInstance Type=vm:SystemUserViewModel}"
    IsEnabled="{Binding Source={x:Static auth:LoginAuthHelper.LoginUser}, Path=LoginAuth, Converter={StaticResource EngineerEnabled}}"
    mc:Ignorable="d">
    <Page.Resources>
        <convert:AuthConverter x:Key="AuthConverter" />
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>

        <!--  工具栏  -->
        <StackPanel
            Grid.Row="0"
            Margin="10"
            Orientation="Horizontal">
            <!--  绑定搜索数据源 且立即触发更新  -->
            <TextBox
                Width="200"
                Height="35"
                Margin="0,0,10,0"
                VerticalAlignment="Center"
                hc:InfoElement.Foreground="{DynamicResource Text.Primary.Brush}"
                hc:InfoElement.TitlePlacement="Left"
                Background="{DynamicResource Background.Brush}"
                BorderBrush="{DynamicResource Border.Brush}"
                Foreground="{DynamicResource Text.Primary.Brush}"
                Style="{StaticResource TextBoxExtend}"
                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

            <Button
                Width="80"
                Height="35"
                Margin="0,0,10,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding SearchCommand}"
                Content="{i18n:Localize btn.Search}"
                Foreground="{DynamicResource Text.Primary.Brush}" />

            <ComboBox
                Width="180"
                Height="35"
                Margin="0,0,10,0"
                hc:InfoElement.Foreground="{DynamicResource Text.Primary.Brush}"
                hc:InfoElement.Title="{i18n:Localize btn.PageSize}"
                hc:InfoElement.TitlePlacement="Left"
                Background="{DynamicResource Background.Brush}"
                BorderBrush="{DynamicResource Border.Brush}"
                Foreground="{DynamicResource Text.Primary.Brush}"
                ItemsSource="{Binding PageSizes}"
                SelectedItem="{Binding SelectedPageSize}"
                Style="{StaticResource ComboBoxExtend}">
                <ComboBox.Resources>
                    <SolidColorBrush x:Key="RegionBrush" Color="{DynamicResource Background.Color}" />
                    <SolidColorBrush x:Key="BorderBrush" Color="{DynamicResource Border.Color}" />
                </ComboBox.Resources>
            </ComboBox>


            <Button
                Width="100"
                Height="35"
                Margin="0,0,10,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding AddCommand}"
                Content="{i18n:Localize btn.AddUser}"
                Foreground="{DynamicResource Text.Primary.Brush}" />
        </StackPanel>

        <!--  数据表格  -->
        <DataGrid
            Grid.Row="1"
            Width="auto"
            Margin="10"
            AlternatingRowBackground="{DynamicResource Surface.Brush}"
            AutoGenerateColumns="False"
            Background="{DynamicResource Background.Brush}"
            BorderBrush="{DynamicResource Border.Brush}"
            BorderThickness="1"
            FontSize="20"
            GridLinesVisibility="All"
            HeadersVisibility="Column"
            HorizontalGridLinesBrush="{DynamicResource Border.Brush}"
            IsReadOnly="True"
            ItemsSource="{Binding CurrentPageData}"
            LoadingRow="DataGrid_LoadingRow"
            RowBackground="{DynamicResource Background.Brush}"
            RowHeaderWidth="40"
            VerticalGridLinesBrush="{DynamicResource Border.Brush}">
            <!-- <DataGrid.Resources> -->
            <!--     <Style TargetType="DataGridColumnHeader"> -->
            <!--         <Setter Property="Background" Value="{DynamicResource Surface.Brush}" /> -->
            <!--         <Setter Property="Foreground" Value="{DynamicResource Text.Primary.Brush}" /> -->
            <!--         <Setter Property="BorderBrush" Value="{DynamicResource Border.Brush}" /> -->
            <!--         <Setter Property="BorderThickness" Value="0,0,1,1" /> -->
            <!--         <Setter Property="Padding" Value="10" /> -->
            <!--         <Setter Property="HorizontalContentAlignment" Value="Center" /> -->
            <!--     </Style> -->
            <!--    -->
            <!-- </DataGrid.Resources> -->
            <DataGrid.Columns>
                <!--  使用 LoadingRow 事件  -->
                <DataGridTextColumn
                    Width="auto"
                    Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                    Header="{i18n:Localize Table.Serial}"
                    IsReadOnly="True" />

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Id}"
                    Header="{i18n:Localize Table.DbSerial}">
                    <DataGridTextColumn.CellStyle>
                        <Style BasedOn="{StaticResource cell}" TargetType="DataGridCell">
                            <!--  其他样式设置保持不变  -->
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <ToolTip>
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnName" />
                                            <TextBlock i18n:I18nLocalizeAttach.AutoLocalize="Table.DbSerial" />
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnValue" />
                                            <TextBlock Text="{Binding Id}" />
                                        </StackPanel>
                                    </ToolTip>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding UserName}"
                    Header="{i18n:Localize Table.Name}">
                    <DataGridTextColumn.CellStyle>
                        <Style BasedOn="{StaticResource cell}" TargetType="DataGridCell">
                            <!--  其他样式设置保持不变  -->
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <ToolTip>
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnName" />
                                            <TextBlock i18n:I18nLocalizeAttach.AutoLocalize="Table.Name" />
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnValue" />
                                            <TextBlock Text="{Binding UserName}" />
                                        </StackPanel>
                                    </ToolTip>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Password}"
                    Header="{i18n:Localize Table.Password}">
                    <DataGridTextColumn.CellStyle>
                        <Style BasedOn="{StaticResource cell}" TargetType="DataGridCell">
                            <!--  其他样式设置保持不变  -->
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <ToolTip>
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnName" />
                                            <TextBlock i18n:I18nLocalizeAttach.AutoLocalize="Table.Password" />
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnValue" />
                                            <TextBlock Text="{Binding Password}" />
                                        </StackPanel>
                                    </ToolTip>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding CreateTime}"
                    Header="{i18n:Localize Table.CreateTime}">
                    <DataGridTextColumn.CellStyle>
                        <Style BasedOn="{StaticResource cell}" TargetType="DataGridCell">
                            <!--  其他样式设置保持不变  -->
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <ToolTip>
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnName" />
                                            <TextBlock i18n:I18nLocalizeAttach.AutoLocalize="Table.CreateTime" />
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnValue" />
                                            <TextBlock Text="{Binding CreateTime}" />
                                        </StackPanel>
                                    </ToolTip>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding LoginAuth}"
                    Header="{i18n:Localize Table.Permission}">
                    <DataGridTextColumn.CellStyle>
                        <Style BasedOn="{StaticResource cell}" TargetType="DataGridCell">
                            <!--  其他样式设置保持不变  -->
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <ToolTip>
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnName" />
                                            <TextBlock i18n:I18nLocalizeAttach.AutoLocalize="Table.Permission" />
                                            <TextBlock FontWeight="Bold" i18n:I18nLocalizeAttach.AutoLocalize="Table.ColumnValue" />
                                            <TextBlock Text="{Binding LoginAuth, Converter={StaticResource AuthConverter}}" />
                                        </StackPanel>
                                    </ToolTip>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.CellStyle>
                </DataGridTextColumn>

                <!--  新增操作列  -->
                <DataGridTemplateColumn Width="auto" Header="{i18n:Localize Table.Operation}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Width="60"
                                    Height="30"
                                    Margin="5,0"
                                    Background="{DynamicResource Primary.Brush}"
                                    Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    i18n:I18nLocalizeAttach.AutoLocalize="btn.Edit"
                                    Foreground="{DynamicResource Text.Primary.Brush}"
                                    Style="{StaticResource ButtonSuccess}" />
                                <Button
                                    Width="60"
                                    Height="30"
                                    Margin="5,0"
                                    Background="{DynamicResource Danger.Brush}"
                                    Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    i18n:I18nLocalizeAttach.AutoLocalize="btn.Delete"
                                    Foreground="{DynamicResource Text.Primary.Brush}"
                                    Style="{StaticResource ButtonDanger}" />
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!--  分页控件  -->
        <StackPanel
            Grid.Row="2"
            Margin="10"
            HorizontalAlignment="Center"
            Orientation="Horizontal">
            <Button
                Width="80"
                Height="35"
                Margin="5,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding FirstPageCommand}"
                Content="{i18n:Localize btn.FirstPage}"
                Foreground="{DynamicResource Text.Primary.Brush}" />
            <Button
                Width="80"
                Height="35"
                Margin="5,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding PreviousPageCommand}"
                Content="{i18n:Localize btn.PreviousPage}"
                Foreground="{DynamicResource Text.Primary.Brush}" />

            <TextBlock
                Margin="10,0"
                VerticalAlignment="Center"
                Foreground="{DynamicResource Text.Primary.Brush}">
                <Run Text="{i18n:Localize SkipPage.Page_No}" />
                <Run Text="{Binding CurrentPage}" />
                <Run Text="{i18n:Localize SkipPage.Page_Total}" />
                <Run Text="{Binding TotalPages}" />
                <Run Text="{i18n:Localize SkipPage.Page_Page}" />
            </TextBlock>

            <Button
                Width="80"
                Height="35"
                Margin="5,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding NextPageCommand}"
                Content="{i18n:Localize btn.NextPage}"
                Foreground="{DynamicResource Text.Primary.Brush}" />
            <Button
                Width="80"
                Height="35"
                Margin="5,0"
                Background="{DynamicResource Primary.Brush}"
                Command="{Binding LastPageCommand}"
                Content="{i18n:Localize btn.LastPage}"
                Foreground="{DynamicResource Text.Primary.Brush}" />

            <TextBlock
                Margin="10,0"
                VerticalAlignment="Center"
                Foreground="{DynamicResource Text.Primary.Brush}">
                <Run Text="{i18n:Localize SkipPage.Page_General}" />
                <Run Text="{Binding TotalItems}" />
                <Run Text="{i18n:Localize SkipPage.Record_Total}" />
            </TextBlock>
        </StackPanel>
    </Grid>
</Page>